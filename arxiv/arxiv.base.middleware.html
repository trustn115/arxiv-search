
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>arxiv.base.middleware package &#8212; arXiv base 0.2 documentation</title>
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/graphviz.css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="arxiv.base.middleware.base module" href="arxiv.base.middleware.base.html" />
    <link rel="prev" title="arxiv.base.agent.tests module" href="arxiv.base.agent.tests.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="module-arxiv.base.middleware">
<span id="arxiv-base-middleware-package"></span><h1>arxiv.base.middleware package<a class="headerlink" href="#module-arxiv.base.middleware" title="Permalink to this headline">¶</a></h1>
<p>WSGI middleware integration for Flask apps.</p>
<p>A WSGI middleware sits “between” the WSGI server (e.g. uWSGI) and the Flask
application. This allows us to execute code on each request, either before or
after the request is handled by Flask application. For example, a middleware
could be used to parse and validate authorization information before a request
is handled. In practical terms, a middleware is a wrapper around a Flask
application instance.</p>
<div class="section" id="writing-a-middleware">
<h2>Writing a middleware<a class="headerlink" href="#writing-a-middleware" title="Permalink to this headline">¶</a></h2>
<p>Middlewares may subclass <a class="reference internal" href="arxiv.base.middleware.base.html#arxiv.base.middleware.base.BaseMiddleware" title="arxiv.base.middleware.base.BaseMiddleware"><code class="xref py py-class docutils literal notranslate"><span class="pre">base.BaseMiddleware</span></code></a>, which implements some
of the boilerplate needed to make the middleware work with Flask. In that case,
the middleware class need only implement one or both of:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">before(environ:</span> <span class="pre">dict,</span> <span class="pre">start_response:</span> <span class="pre">Callable)</span> <span class="pre">-&gt;</span> <span class="pre">Tuple[dict,</span> <span class="pre">Callable]</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">after(response:</span> <span class="pre">Iterable)</span> <span class="pre">-&gt;</span> <span class="pre">Iterable</span></code></li>
</ul>
<p>For example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">arxiv.base.middleware</span> <span class="kn">import</span> <span class="n">BaseMiddleware</span>

<span class="k">class</span> <span class="nc">FooMiddleware</span><span class="p">(</span><span class="n">BaseMiddleware</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Adds the parameter ``foo`` to the request environment.&#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">before</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">environ</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">start_response</span><span class="p">:</span> <span class="n">Callable</span><span class="p">)</span> \
            <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">dict</span><span class="p">,</span> <span class="n">Callable</span><span class="p">]:</span>
        <span class="sd">&#39;&#39;&#39;Insert ``foo`` into the environment, and handle the request.&#39;&#39;&#39;</span>
        <span class="n">environ</span><span class="p">[</span><span class="s1">&#39;foo&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;bar&#39;</span>
        <span class="k">return</span> <span class="n">environ</span><span class="p">,</span> <span class="n">start_response</span>
</pre></div>
</div>
<p>In the example above, the <code class="docutils literal notranslate"><span class="pre">'foo'</span></code> parameter would be available on the
<a href="#id1"><span class="problematic" id="id2">:prop:`.Flask.request.environ`</span></a> object within the Flask application.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">request</span>

<span class="nd">@app.route</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">my_route</span><span class="p">():</span>
    <span class="n">foo</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;foo&#39;</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">f</span><span class="s1">&#39;The value of foo is {foo}&#39;</span>
</pre></div>
</div>
<p>For more information, see the <a class="reference external" href="https://www.python.org/dev/peps/pep-0333/">WSGI spec</a>.</p>
</div>
<div class="section" id="adding-a-middleware-to-a-project">
<h2>Adding a middleware to a project<a class="headerlink" href="#adding-a-middleware-to-a-project" title="Permalink to this headline">¶</a></h2>
<p>This module provides a function called <a class="reference internal" href="#arxiv.base.middleware.wrap" title="arxiv.base.middleware.wrap"><code class="xref py py-func docutils literal notranslate"><span class="pre">wrap()</span></code></a> that applies a list of
middlewares to a <code class="xref py py-class docutils literal notranslate"><span class="pre">Flask</span></code> application. This works by instantiating a
middleware class with a reference to the Flask app, and then replacing the
app’s <code class="docutils literal notranslate"><span class="pre">wsgi_app</span></code> property with the middleware. In this sense, the middleware
wraps the Flask application.</p>
<p><a class="reference internal" href="#arxiv.base.middleware.wrap" title="arxiv.base.middleware.wrap"><code class="xref py py-func docutils literal notranslate"><span class="pre">wrap()</span></code></a> applies middlewares in reverse order, which means that the
first middleware will be the “outermost” middleware, and will therefore be
called first upon each request.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">arxiv.base.middleware</span> <span class="kn">import</span> <span class="n">wrap</span>
<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="s1">&#39;some_app&#39;</span><span class="p">)</span>
<span class="n">wrap</span><span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="p">[</span><span class="n">FirstMiddleware</span><span class="p">,</span> <span class="n">SecondMiddleware</span><span class="p">,</span> <span class="n">ThirdMiddleware</span><span class="p">])</span>
</pre></div>
</div>
<dl class="function">
<dt id="arxiv.base.middleware.wrap">
<code class="descclassname">arxiv.base.middleware.</code><code class="descname">wrap</code><span class="sig-paren">(</span><em>app</em>, <em>middlewares</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/arxiv/base/middleware.html#wrap"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#arxiv.base.middleware.wrap" title="Permalink to this definition">¶</a></dt>
<dd><p>Wrap an application factory function in WSGI middlewares.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>app_factory</strong> (<em>function</em>) – Should be a Flask application factory, or a middleware that wraps a
Flask application factory.</li>
<li><strong>middlewares</strong> (<a class="reference external" href="https://docs.python.org/3.6/library/stdtypes.html#list" title="(in Python v3.6)"><em>list</em></a>) – A list of callables that return an app factory callable. These are
applied in reverse, so that the first middleware is the “outermost”
wrapper around the base <code class="docutils literal notranslate"><span class="pre">app_factory</span></code> and is therefore called first.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">A callable that behaves like a Flask application factory.</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first">function</p>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last"><a class="reference external" href="https://docs.python.org/3.6/library/typing.html#typing.Callable" title="(in Python v3.6)"><code class="xref py py-data docutils literal notranslate"><span class="pre">Callable</span></code></a></p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</div>
<div class="section" id="submodules">
<h2>Submodules<a class="headerlink" href="#submodules" title="Permalink to this headline">¶</a></h2>
<div class="toctree-wrapper compound">
<ul>
<li class="toctree-l1"><a class="reference internal" href="arxiv.base.middleware.base.html">arxiv.base.middleware.base module</a></li>
<li class="toctree-l1"><a class="reference internal" href="arxiv.base.middleware.request_logs.html">arxiv.base.middleware.request_logs module</a></li>
<li class="toctree-l1"><a class="reference internal" href="arxiv.base.middleware.tests.html">arxiv.base.middleware.tests module</a></li>
</ul>
</div>
</div>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">arXiv base</a></h1>








<h3>Navigation</h3>
<p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="modules.html">arxiv</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="arxiv.html">arxiv package</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="metadocs.html">Meta-documentation: How to create documentation</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="modules.html">arxiv</a><ul>
  <li><a href="arxiv.html">arxiv package</a><ul>
  <li><a href="arxiv.base.html">arxiv.base package</a><ul>
      <li>Previous: <a href="arxiv.base.agent.tests.html" title="previous chapter">arxiv.base.agent.tests module</a></li>
      <li>Next: <a href="arxiv.base.middleware.base.html" title="next chapter">arxiv.base.middleware.base module</a></li>
  </ul></li>
  </ul></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2017, arXiv Team.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.8.2</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../_sources/arxiv/arxiv.base.middleware.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>